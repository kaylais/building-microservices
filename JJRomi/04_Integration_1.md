# CHAPTER 4 . 통합
> 좋은 마이크로서비스의 핵심 원칙은 강한 응집력과 느슨한 결합력이다.

- 마이크로 서비스는 기존 소비자 서비스에 영향을 미치지 않아야 한다.
- 필요한 기술 스택을 좌우하는 통합 기술은 피해야한다.
- 새로운 고객이 등록되면 금융 결제 또는 환영 이메일과 같은 부가적인 프로세스를 시작해야하고, 정보를 변경, 삭제하는 등 또 다른 비즈니스 프로세스가 작동할 수 있다.
- DB란 사실상 공유된 매우 큰 API로 깨지기 쉬우며 대규모의 회귀테스트가 필요하다.

## 동기(synchronous)
- 원격 서버에 대한 호출이 완료될때까지 연산 작업 중단
- 작업 완료 시간을 추론하기 쉬움
- 요청/응답 방식

## 비동기(asynchronous)
- 호출자는 작업이 완료되었다는 회신을 기다리지 않으며,작업의 완료 여부에 관심 없을때도 있다.
- 클라이언트와 서버 간 접속이 오랫동안 유지하기 어려운 장기 작업에 유용하다.
- 결과를 기다리는 동안 중단된 호출이 성능 저하를 일으키는 곳에서 짧은 지연시간이 필요할 때 적합하다.
- 동기 통신보다 처리하는 기술이 조금 더 복잡할 수 있다.

## 요청(request)/응답(response)
- 동기 통신과 명확하게 일치
- 비동기 통신에서는 작업이 완료되었을 때 알려주도록 요청하는 콜백으로 등록할 수 있다.

## 이벤트 기반 협업
- 비동기적이며 매우 결합도가 낮은 방식
- 비즈니스 로직이 핵심 두뇌로 집중화되기보다는 다양한 협업자들에게 고르게 분배된다.
- 이벤트를 발산하는 클라이언트는 이벤트에 반응하는 대상이 누구인지 또는 무엇인지 전혀 알지 못한다.

## 오케스트레이션(orchestration)
- 오케스트라 지휘자처럼 프로세스를 안내하고 구동하는 하나의 중앙 두뇌에 의존한다.
- 고객 서비스에 지나치게 많은 중앙 관리 권한이 부여되는 단점이 있다. 
- 지나치게 의존하는 구현체는 매우 취약하고 높은 변경 비용을 수반한다.

## 코레오그래피(choreography)
- 발레 무용수들이 자신의 역할을 알고 주변의 다른 무용수에 반응하는 것처럼 시스템 각 부분에 작업 내용을 알리고 세부 사항을 수행한다.
- 고객 서비스가 비동식 방식으로 '고객이 생성되었다'라는 이벤트를 발산할 뿐이다.
- 전반적으로 더 느슨히 결합하고 유연하며 변경을 보다 쉽게 수용한다.
- 서비스 경계를 넘어 프로세스를 모니터링하고 추천하는 부가 작업이 필요하다.

## 원격 프로시저 호출 (Remote Procedure Call)
- 지역 호출 (local call)을 통해 원격 서비스를 실행하는 기술이다.
- RPC 구현체들은 매우 빠르게 시작할 수 있는 클라이언트와 서버 스텁을 생성하게 한다. 
- 네트워크 경계를 넘어 즉시 콘텐트(데이터)를 보낼 수 있다.
- 쉽게 만들고 빠르게 실행할 수 있다.
- 상호호환성에서 제약이 있다.
- RPC 아이디어의 핵심은 원격호출의 복잡성을 은폐하는 것이다.
- 지역호출은 원격 호출과 다르다.

## REST (Representational State Transfer)
- 웹에서 영감을 얻은 아키텍처 방식이다.
- 자원(resource)개념이 가장 중요하다.
- HTTP 동사(verb)처럼 HTTP 명세서에는 제공되는 일부 기능은 HTTP 상의 REST 의 구현을 용이하게 해준다.
- 다양한 REST방식을 비교한 [리차드의 성숙모델(Richardson Maturity Model)](http://bit.ly/1fh24Gt) 참조

## REST와 HTTP
- REST 아키텍처 방식은 실제로 메서드가 모든 자원에 대해 같은 방식으로 동작한다.
- HTTP 사양서에는 우리가 사용할 수 있는 다수의 메서드가 정의되어 있다.
- **POST**해서 서버가 새로운 자원을 생성하도록 요청하고, **GET**요청을 통해 자원의 표현을 얻을 수 있다.

## 애플리케이션 상태 엔진으로서의 하이퍼미디어 (HATEOAS)
-  Hypermedia As The Engine Of Application State
- 클라이언트가 다른 자원에 대한 링크를 통해 서버와 (잠재적으로 상태 변이를 초래하는) 상호작용을 한다는 것이다.
- 어떤 URI를 요청했는지 알고 있으므로 서버 내 고객의 정확한 위치를 알 필요가 없다.
- 대신 클리언트는 필요한 것을 발견하기 위해 링크를 찾고 탐색한다.
- 하이퍼미디어 컨트롤을 통해 서비스 소비자들을  위한 동일 수준의 영리함을 달성하고자 한다.
    - 하이퍼미디어 컨트롤은 아티스트에 대한 정보를 어디서 찾아야 할지 보여준다.
    - 우리가 이 앨범을 구매하기 원한다면 이제는 어디로 가야 할지 알고 있다.

## JSON, XML 
- 표준 텍스트 포맷을 사용하면 클라이언트는 자원을 유연하게 소비할 수 있으며 HTTP 상의 REST로 다양한 포맷을 사용할 수 있다.
- HTTP 상에서 작동하는 서비스의 경우에는 JSON이 훨씬 대중적인 콘텐트 타입이다.
- JSON이 XML에 비해 상대전으로 간소하다.
- XML은 link 컨트롤을 하이퍼미디어 컨트롤로 정의한다.
- JSON 표준은 그와 유사한 어떤 것도 정의하지 않기 때문에 해당 콘셉트를 넣기 위해 자체 방식을 사용한다.

## HTTP 기반 REST의 단점
- 소비자의 사용 편의성에 있어 HTTP 기반의 REST 애플리케이션 프로토콜용 클라이턴트 스텁은 RPC에서 한 것처럼 쉽게 생성되지 않는다.
- 일부 웹 서버 프레임워크가 실제로는 모든 HTTP 메서드를 제대로 지원하지 않는다.
    - GET 또는 POST 요청 처리기는 만들기 쉽지만 PUT 또는 DELETE 요청을 처리하려면 많은 노력이 필요하다.
- HTTP 가 대규모 트래픽에는 적합할 수 있지만 TCP 또는 다른 네트워킹 기술 기반의 대체 프로토콜과 비교하면 낮은 지연시간이 필요한 통신에는 그다지 좋은 선택이라고 할 수 없다.

## 비동기 이벤트 기반의 협업 구현
- 이벤트 기반 아키텍처는 확실히 더 분리되고 확장 가능한 시스템으로 우리를 인도한다.
- 프로그래밍 방식이 복잡성을 더하기도 한다.
- 적재적소에서 모니터링하고 프로세스 경계 요청을 추적할 수 있도록 상관관계 ID(correlation ID)의 사용을 적극 검토할 필요가 있다.




 
 
