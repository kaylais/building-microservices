# 4장 통합
> 이번 장에서 소비자는 경제학에서 말하는 재화, 용역을 사용하는 사람이 아닌 <br/>
SOA 및 웹 서비스 개념에서의 서비스 공급자가 제공하는 서비스를 호출하여 사용하는 서비스 소비자 또는 서비스 클라이언트를 의미

### 이상적인 통합 기술 모색
1. 호환성을 깨트리는 변경 피하기 - 개발자에 의한 변경이 가능한 기존 소비자 서비스에는 영향을 미치지 말아야 함
1. 기술 중립적인 API 생성 - 마이크로서비스 구현에 필요한 기술 스택응ㄹ 좌우하는 통합 기술을 회피하는 것을 의미
1. 소비자를 위한 서비스 단순화
1. 내부 구현 상세 감추기 - 내부의 세부 표현을 외부로 노출하도록 강요하는 그 어떤 기술도 피해야 한다

### 고객과의 인터페이싱
고객 생성은 단순한 CRUD 명령의 집합으로 간주할 수 있으나 <br/>
여러가지 프로세스(환영 이메일 발송, 결제 등)를 시작하고 고객 정보 변경/삭제 시 다른 비즈니스 프로세스가 작동할 수 있음

### 공유 데이터베이스
현업에서 가장 일반적 통합 형태는 데이터베이스(DB) 통합이나 아래와 같은 문제점 존재
1. 외부에서 내부 구현 상세를 조회하고 결합하는 것을 허용
1. 소비자들이 특정 기술을 선택하는 범위의 제한
1. 마이크로서비스 핵심원칙인 강한 응집력과 느슨한 결합력을 잃음

### 동기와 비동기 (synchronous / asynchronous)
> 동기 통신   - 원격 서버에 대한 호출이 완료될 때까지 연산 작업 중단 / 언제 작업이 성공적으로 완료되었는지 알 수 있어 추론하기 쉬움<br/>
비동기 통신 - 호출자는 작업 완료 회신을 기다리지 않으며, 작업 완료 여부에 관심 없을 때도 있음 / 클라이언트, 서버 간 오랜 접속을 유지하기 어려운 작업에 유용

서로 다른 두 통신은 요청/응답 또는 이벤트 기반이라는 관용적 협력 방식을 가능케 함
> 요청/응답(request / response ) - 클라이언트 요청을 시작하고 응답을 기다리는 것, 두 가지 통신 방법에 모두 작동
> - 클라이언트는 작업 요청을 보내고 그 작업이 완료되었을 때 서버가 알려주도록 요청하는 콜백을 등록할 수 있음

> 이벤트 기반 협업 - 클라이언트가 완료되어할 작업을 요청하는 대신 일(사건)이 발생했음을 알리고 다른 당사자들이 무엇을 해야 할지 기대

### 오케스트레이션과 코레오그래피
1. 오케스트레이션 방식<br/>
프로세스를 안내, 구동하는 하나의 중앙 두뇌에 의존(오케스트라의 지휘자)<br/>
중앙 관리 권한이 지나치게 많이 부여되는 단점<br/>
1. 코레오그래피 방식<br/>
시스템 각 부분에 작업 내용을 알리고 세부 수항을 수행(발레 무용수들이 주변의 다른 무용수에 반응하는 것)<br/>
비동기 방식으로 이벤트 생성을 알림(느슨한 결합을 이끌어 냄)<br/>
> 코레오그래피 방식이 전반적으로 더 느슨히 결합하고 유연하며 변경을 보다 쉽게 수용.<br/>
시스템 경계를 넘어 프로세스를 모니터링하고 추적하는 부가작업이 필요 
   
### 원격 프로시저 호출 remote procedure call
> 지역호출을 통해 원격 서비스를 실행하는 기술
1. 기술 결합 - 내부의 기술 구현 상세를 노출하는 형태일 수 있음(예: JVM이 클라이언트 뿐만 아니라 서버와도 관계가 있음을 의미)
2. 지역 호출은 원격 호출과 다르다 - RPC 아이디어의 핵심은 원격 호출의 복잡성을 은폐하는 것이나 수많은 구현체가 이를 지나치게 은폐
3. 취성 - 네트워크 바이너리 직렬화에 사용되는 객체는 '확장만 가능한 타입'으로 간주, 이러한 취성으로 인해 네트워크를 통해 타입이 노출되고 객체는 필드 투성이가 될 수 있음(필드가 더 이상 사용되지 않더라도 삭제하기 어려움)
4. RPC는 형편없는가 - 많은 연산 작업은 RPC 기반의 모델에 적합, 프로토콜 버퍼나 쓰리프트처럼 더 현대적 메커니즘은 클라이언트와 서버 코드 간 릴리즈보조가 필요 없도록 RPC의 과거 단점을 보완 중
> RPC와 관련 잠재적 함정<br/>
네트워크가 완전히 은폐될 정도로 원격 호출을 추상화 하지 말라.<br/>
서버와 보조를 맞춘 클라이언트의 업그레이드 없이도 서버 인터페이스를 발전시킬 수 있는가 확인해라

### REST
> 웹에서 영감을 얻은 아키텍처 방식 
1. REST와 HTTP<br/>
> HTTP 자체적으로 REST 방식과 궁합이 맞는 유용한 기능을 정의(GET, POST...)<br/>
> REST 아키텍처 방식은 실제 메서드가 모든 자원에 대해 같은 방식으로 작동<br/>
2. 애플리케이션 상태 엔진으로서의 하이퍼미디어<br/>
> 클라이언트와 서버가 결합되지 않게 도와주는 또 다른 원칙<br/>
> 하이퍼미디어란 하나의 콘텐트가 텍스트나 이미지, 사운드와 같은 다양한 포맷의 다양한 콘텐트를 링크하는 개념<br/>
> 단점은 클라이언트가 수행할 작업을 찾기 위해 링크를 따라가기 떄문에 컨트롤 탐색에 꽤 많은 호출
3. JSON, XML 또는 다른 것?<br/>
> HTTP 상에서 작동하는 서비스의 경우 JSON이 훨씬 대중적인 콘텐트 타입(단순한 포맷이라 소비하기도 더 쉽다는 것을 의미)
4. 지나친 편의 주의<br/>
> 외부로 직접 노출하는 일련의 작업을 매우 쉽게 만듬
5. HTTP 기반 REST의 단점<br/>
> 소비자 사용 편의성에 있어 HTTP 기반의 REST 어플리케이션 프로토콜용 클라이언트 스텁은 RPC 에서 한 것처럼 쉽게 생성되지 않음<br/>
> 일부 웹 서버 프레임워크가 실제로는 모든 HTTP 메서드를 제대로 지원하지 않음<br/>
> 각각의 HTTP 요청에서 늘 발생하는 HTTP 부하 역시 낮은 지연 시간이 요구될 떄 문제 발생 가능성<br/>

### 비동기 이벤트 기반의 협업 구현
1. 기술 선택
> 우리가 고려해야 할 두가지 주요문제는 마이크로서비스가 이벤트를 발산하는 방법과 소비자가 생성된 이벤트를 찾는 방법<br/>
2. 비동기 아키텍처의 복잡성


- - -
취성 : 물체가 외력(外力)을 받았을 때 소성 변형(塑性變形)을 거의 보이지 않고 파괴되는 성질. 메짐성
