모니터링
=====
시스템을 더 세분화도니 마이크로서비스로 분해하면 많은 혜택을 얻지만 실환경 시스템을 모니터링하는 관점에서 볼 때 복잡도가 증가한다.
>> 작은 것들을 모니터링 하고 전체 상황을 볼 수 있도록 취합하라-
<br />

## 단일 서비스, 단일 서버
관찰해야 할 것
- 호스트 자체 모티터링 : 시스템이 정상일 때 이들의 정상 범위를 알고 있어야 범위를 벗어날 때 주의 경보를 보낼 수 있다
- 서버 자체 로그 접근 : 사용자가 에러 리포트를 한다면 로그는 에러를 추출, 그 것이 어디서 발생하는지 알려줘야 한다
- 애플리케이션 자체 모니터링 - 최소한 서비스의 응답시간 모니터링
*****

## 단일 서비스, 다수 서버
이전처럼 동일한 모든 것을 모니터링 하고 싶지만 문제는 격리할 수 있는 방법으로 진행
- 모든 것을 취합하고 분석 : 호스트 레벨의 측정지표를 추적하고 지표에 대한 주의 경보를 원하지만 개별 호스트 뿐 아니라 모든 호스트에서 발생하는지 등의 정보
- 로그 : 몇 개의 호스트만 있다면 여러 호스트에 동일한 명령 실행이 가능한 도구 사용(SSH 멀티플랙스 등)
- 부하 분산기에서 추적해 응답 시간 추적 같은 작업의 취합은 물론 분산기도 추적대상이 되어야 함
*****

## 다수 서비스, 다수 서버
로그부터 애플리케이션 측정지표까지 가능한 한 많은 수집,집중식 취합 필요
*****

## 로그, 로그, 더 많은 로그
로그를 수집하고 중앙에서 접근하기 위해 전문적인 서브 시스템을 사용<br/>
예) 로그스태쉬(logstash) - 많은 로그 파일 포맷을 파싱, 추가 분석을 위해 하부 시스템에 전송
*****

## 다수 서비스 간의 측정지표 추적
그래파이트
- 측정지표 추적을 쉽게 만들어주는 시스템 중 하나
- 단순한 API 제공, 실시간 측정지표 전송 및 다양한 디스플레이 생성을 위해 측정지표에 대한 질의 가능
- 여러 표본을 취합, 한 표본을 따라 자세히 검색함으로써 전체 시스템, 서비스 그룹 또는 단일 인스턴스에 대한 응답시간을 알 수 있음

만약 그래파이트가 아닌 다른 도구를 사용하고자 한다면, <br />
그래파이트와 유사한 기능이 있는지, 필요할 경우 자체 리포팅과 대시보드를 제공하기 위해 원본 데이터에 접근할 수 있는지 확인할 것!

>> 측정지표의 추이를 이해하는 또 다른 혜택은 "용량계획" <br/>
>> 사용 패턴을 이해하면 필요에 부응하는 충분한 인프라스트럭처를 보유할 수 있음을 의미<br/>
>> 트렌드의 추적가 트렌드에 따라 할 일에 대해 더 잘 알 수 있도록 시스템의 비용 효율성, 응답도도 높아짐

*****

## 서비스 측정 지표
>> 서비스 스스로 기본적인 측정지표를 발상해야 한다<br/>
>> 웹 서비스라면 최소한 기본으로 응답시간, 에러율 같은 측정표를 노출해야 한다. 만약 이런 일을 대신하는 웹 서버가 서버 앞단에 없다면 그 것은 필수다. 

왜 이런 것이 관심을 가지는 것일까?
- 소프트웨어 기능의 80%는 결코 사용되지 않는다는 오래된 속설
- 우리는 시스템을 어떻게 개선해야 할지 알기 위해 사용자가 우리 시스템을 사용하는 방식에 이전보다 더 잘 대응
- 우리는 어떤 데이터가 유용할지 결코 알 수 없다.
*****

## 합성 모니터링
실전에서는 저수준 측정지표에 대한 경고보다 유의적 모니터링을 수행하기 위한 합성 트랜잭션 사용이 시스템 상의 문제를 훨씬 더 잘 나타내는 지표, 하지만 유의적 모니터링으로 문제를 리포트할 때는 상세한 이유가 필요함으로 합성 트랜잭션이 저수준의 측정 지표를 대처하는 것은 아님
1. 유의적 모니터링 구현하기<br/>
엔드투엔드 테스트를 살펴보면 유의적 모니터링 구현에 필요한 것을 보유하고 있다는 것을 알 수 있다. 즉, 시스템은 테스트 실행과 결과 확인에 필요한 수단을 이미 제공, 따라서 이 테스트의 일부 집합을 시스템을 지속적으로 모니터링 하는 방법으로 사용하는 것은 어떨까? <br/>
다만 몇 가지 추가 작업 필요<br/>
-> 테스트의 데이터 요구 사항에 대해 주의<br/>
-> 예측하지 못한 부작용을 우발적으로 만들지 않도록 보장
*****

## 상관관계 ID
상관관계 ID 이용 -  <br/>
첫 호출이 이뤄질 때 호출에 대한 전역 호출 식별자를 생성하고 후속하는 모든 호출에 전달, 로그 레벨이나 날짜와 같은 구성 요소와 함께 구조화된 방식으로 로그를 넣을 수 있으며 올바른 로그 집계 도구를 통해 시스템에서 일관되게 추적할 수 있을 것이다.

각각의 서비스가 상관관계 ID 전달을 이해하도록 해야 한다.<br/>
이를 위해 표준화가 필요, 시스템의 경계를 넘어 더욱 강력히 시행되어야 한다<br/>
이렇게 만들어진 도구는 호출의 전체 연결 단계를 파악할 수 있으므로 이벤트 폭풍과 코너 케이스를 추적하거나 심지어 비정상적인 고비용 트랜잭션을 확인하는데 이용 가능하다

>> 처음부터 상관관계 ID를 지원하는 자체 클라이언트 라이브러리를 만들기로 했다면 __라이브러리를 매우 가볍게 유지하고 특정 생산자 서비스와 결합되지 않도록 하라__<br/><br/>
>> 예 - 통신을 위한 하부 프로토콜로 HTTP를 사용하고 있다면 HTTP 헤더 안에 상관관계 ID를 전파하도록 코드에 추가하는 방식으로 표준 HTTP 클라이언트 라이브러리를 감싸라
*****

## 전파
*****

## 표준화
*****

## 관객 고려하기
*****

## 앞으로
*****

## 마치며
*****
