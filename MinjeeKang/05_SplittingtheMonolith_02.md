# 5장 모놀리스 분해하기 - 두번째

### 트랙잭션의 경계
>> 트랙잭션은 이벤트가 모두 발생하거나 전혀 발생하지 않게 해준다.

트랙잭션을 데이터베이스 분야에서 매우 자주 사용해왔지만 데이터베이스에만 적용되는 것은 아님 <br/>
 -> 예) 메시지 브로커는 오래 전부터 트랙잭션 내 메시지를 게시하고 수신해왔음  <br/>
모놀로식 스키마의 경우 모든 생성, 업데이트는 단일 트랙잭션 경계 내 수행될 것 <br/>
-> 데이터베이스 분리 시, 단일 트랙잭션에 의해 제공된 안정성을 잃는다 <br/>
>> 주문발주 프로세스가 두 개의 분리된 트랜잭션 경계를 포함할 때... <br/>
>> 주문 테이블 삽입에 실패하면 일관성을 유지한 상태에서 모든것을 확실히 중단 <br/>
>> 주문 테이블 삽입에는 성공했지만 수집 테이블 삽입에 실패할 경우에는???

1. 나중에 재시도하기
>> 트랜잭션이 완료되었을 때 시스템이 일관성을 유지하는 상태를 보장하기 위해 트랜잭션 경계를 사용하는 대신 향후 특정 시점에 시스템이 스스로 일관성을 유지하는 상태가 될 수 있음을 허용 (최종적 일관성의 또 다른 형태)
2. 전체 작업 중지하기
>> 전체 연산 작업을 중지하고 시스템을 다시 일관성이 유지된 상태로 복귀하는 것 <br/>
>> --> 보상 트랜잭션을 발행, 직전의 트랜잭션을 되돌릴 수 있는 새로운 트랜잭션을 발생<br/>
>> 보상트랜잭션이 실패하면...<br/>
>> 일광성 유지 작업이 여러개라면 각각의 실패모드에 대한 보상 트랜잭션 처리하는 것은 구현은 고사하고 이해하기도 어려움
3. 분산 트랜잭션
>> 보상 트랜잭션을 수동으로 통제하는 방식의 대안은 분산 트랜잭션의 사용<br/> 
>> 하부 시스템에서 수행되는 다양한 트랜잭션을 통제하기 위해 트랜잭션 관리자라는 전체적 통제 프로세스를 사용해서 트랜잭션 내부의 여러 트랜잭션을 확장하려 시도<br/>
>> 2단계 커밋(분산 트랜잭션 처리하는 가장 범용적 알고리즘) - 투표단계가 시작되며 각 참여자는 로컬트랜잭션의 진행 가능 여부를 트랜잭션 매니저에게 알리고 트랜잭션 매니저는 모든 참여자로부터 찬성표를 얻는다면 참여자에게 각각 커밋을 수행하라고 지시, 반대표 하나라도 받는다면 롤백 명령<br/>
>> --> 중앙의 조정 프로세스가 진행을 허락할 때까지 모든 참여자는 중지해야 하는데 이는 장애에 취약함
4. 그렇다면 무엇을 해야할까?
>> 정말로 일관성이 유지되어야 하는 상태가 필요하다면 처음부터 그 상태가 유지되도록 할 수 있는 모든 것을 하라<br/>
>> 기술적 관서메서 벗어나 트랜잭션 자체를 포함할 구체적 개념을 만들어라

### 리포팅

### 리포팅 데이터베이스

### 서비스 호출을 통한 데이터 추출

### 펌프
1. 대체 종착지

### 이벤트 데이터 펌프

### 백업 데이터 펌프

### 실시간을 향해

### 변경 비용

### 원인 파악

### 마치며
